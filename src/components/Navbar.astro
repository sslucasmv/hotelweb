---
// src/components/Navbar.astro
// Limpiamos la ruta actual quitando la barra final si existe para comparar mejor
const pathname = new URL(Astro.request.url).pathname.replace(/\/$/, "") || "/";

// Función auxiliar para verificar si el link está activo
const isActive = (path: string) => {
    if (path === "/") return pathname === "/";
    return pathname.startsWith(path);
};
import { Icon } from 'astro-icon/components';
---
<header 
  class="sticky top-0 z-50 bg-white backdrop-blur-md px-6 py-2 transition-all duration-500 border-b border-transparent" 
  id="main-header"
>
    <div class="max-w-7xl mx-auto flex items-center justify-between">
        
        <div class="flex-shrink-0">
            <a href="/">
                <img src="/images/logohotel.png" alt="Logo Hotel Soleares" class="h-16 w-auto" />
            </a>
        </div>

        <nav class="hidden md:flex items-center gap-10 absolute left-1/2 -translate-x-1/2">
            <a class={`nav-link relative py-2 font-semibold text-gray-600 ${isActive("/") ? "link-active" : ""}`} href="/">Inicio</a>
            <a class={`nav-link relative py-2 font-semibold text-gray-600 ${isActive("/habitaciones") ? "link-active" : ""}`} href="/habitaciones">Habitaciones</a>
            <a class={`nav-link relative py-2 font-semibold text-gray-600 ${isActive("/servicios") ? "link-active" : ""}`} href="/servicios">Servicios</a>
            <a class={`nav-link relative py-2 font-semibold text-gray-600 ${isActive("/contacto") ? "link-active" : ""}`} href="/contacto">Contacto</a>
        </nav>

        <div class="flex items-center gap-4 flex-shrink-0">
            <button class="btn-ocean hidden sm:flex">
               <span class="onda"></span>
               <span class="onda"></span>
               <span class="relative z-10">Contáctenos</span>
            </button>

            
<button 
  class="menu-hamburguesa flex items-center justify-center text-gray-800 p-2 cursor-pointer" 
  id="mobile-menu-open"
  aria-label="Abrir menú de navegación"
>
  <Icon name="material-symbols:menu" class="w-8 h-8" />
</button>


        </div>
    </div>
</header>

<div id="mobile-menu" class="fixed inset-0 z-[60] bg-white transform translate-x-full transition-transform duration-300 md:hidden flex flex-col p-6">
    <div class="flex justify-between items-center">
        <img src="/images/logohotel.png" alt="Logo" class="h-12 w-auto" />
        <button 
  class="flex items-center justify-center p-2 cursor-pointer transition-colors hover:bg-gray-100 rounded-full" 
  id="mobile-menu-close"
  aria-label="Cerrar menú de navegación"
>
  <Icon name="material-symbols:close" class="text-3xl w-8 h-8 text-gray-800" />
</button>
    </div>
    
    <nav class="flex flex-col gap-4 mt-8">
        <a class={`text-lg font-bold p-3 rounded-lg ${isActive("/") ? "text-blue-ocean bg-blue-ocean/10" : "text-gray-600"}`} href="/">Inicio</a>
        <a class={`text-lg font-bold p-3 rounded-lg ${isActive("/habitaciones") ? "text-blue-ocean bg-blue-ocean/10" : "text-gray-600"}`} href="/habitaciones">Habitaciones</a>
        <a class={`text-lg font-bold p-3 rounded-lg ${isActive("/servicios") ? "text-blue-ocean bg-blue-ocean/10" : "text-gray-600"}`} href="/servicios">Servicios</a>
        <a class={`text-lg font-bold p-3 rounded-lg ${isActive("/contacto") ? "text-blue-ocean bg-blue-ocean/10" : "text-gray-600"}`} href="/contacto">Contacto</a>
        
        <div class="mt-4 pt-4 border-t border-gray-100">
            <button class="w-full bg-blue-ocean text-white py-4 rounded-xl font-bold text-lg">
                Contáctenos ahora
            </button>
        </div>
    </nav>
</div>

<style>
    /* Estilos del Link Activo */
    .nav-link { display: inline-block; transition: all 0.3s ease; }
    
    /* Nota: Usamos HEX directo o clases de Tailwind si las variables de CSS fallan */
    .nav-link:hover { color: #0077b6; }
    
    .link-active { color: #0077b6 !important; }
    .link-active::after {
        content: ''; 
        position: absolute; 
        bottom: -2px; 
        left: 50%; 
        transform: translateX(-50%);
        width: 100%; 
        height: 2px;
        background: #0077b6;
        border-radius: 2px;
    }

    @media (min-width: 768px) {
        .menu-hamburguesa { display: none !important; }
    }
</style>

<script>
    function setupMenu() {
        const header = document.getElementById('main-header');
        const mobileMenu = document.getElementById('mobile-menu');
        const openBtn = document.getElementById('mobile-menu-open');
        const closeBtn = document.getElementById('mobile-menu-close');

        // Scroll Logic
        window.addEventListener('scroll', () => {
            if (window.scrollY > 10) {
                header?.classList.add('shadow-xl', 'shadow-blue-900/5', 'border-blue-200/20');
                header?.classList.replace('py-2', 'py-1');
            } else {
                header?.classList.remove('shadow-xl', 'shadow-blue-900/5', 'border-blue-200/20');
                header?.classList.replace('py-1', 'py-2');
            }
        });

        // Mobile Menu Logic
        openBtn?.addEventListener('click', () => mobileMenu?.classList.remove('translate-x-full'));
        closeBtn?.addEventListener('click', () => mobileMenu?.classList.add('translate-x-full'));
        
        mobileMenu?.querySelectorAll('a, button').forEach(el => {
            el.addEventListener('click', () => mobileMenu?.classList.add('translate-x-full'));
        });
    }

    // Se ejecuta al cargar y al navegar (para Astro View Transitions)
    document.addEventListener('astro:page-load', setupMenu);
</script>