---
// Limpiamos la ruta actual quitando la barra final si existe para comparar mejor
const pathname = new URL(Astro.request.url).pathname.replace(/\/$/, "") || "/";

// Función auxiliar para verificar si el link está activo
const isActive = (path: string) => {
    if (path === "/") return pathname === "/";
    return pathname.startsWith(path);
};

import { Icon } from 'astro-icon/components';
---

<header 
  class="sticky top-0 z-50 bg-white backdrop-blur-md px-6 py-2 transition-all duration-500 border-b border-slate-300/60" 
  id="main-header"
>
    <div class="max-w-7xl mx-auto flex items-center justify-between">
        
        <div class="flex-shrink-0">
            <a href="/">
                <img src="/images/logohotel.png" alt="Logo Hotel Soleares" class="h-16 w-auto" />
            </a>
        </div>

        <nav class="hidden md:flex items-center gap-10 absolute left-1/2 -translate-x-1/2">
            <a class={`nav-link relative py-2 font-semibold text-gray-600 ${isActive("/") ? "link-active" : ""}`} href="/">Inicio</a>
            <a class={`nav-link relative py-2 font-semibold text-gray-600 ${isActive("/habitaciones") ? "link-active" : ""}`} href="/habitaciones">Habitaciones</a>
            <a class={`nav-link relative py-2 font-semibold text-gray-600 ${isActive("/servicios") ? "link-active" : ""}`} href="/servicios">Servicios</a>
            <a class={`nav-link relative py-2 font-semibold text-gray-600 ${isActive("/alojamientoEmpresas") ? "link-active" : ""}`} href="/alojamientoEmpresas">Alojamiento para empresas</a>
        </nav>

        <div class="flex items-center gap-4 flex-shrink-0">
            <button class="btn-ocean hidden sm:flex">
                <span class="onda"></span>
                <span class="onda"></span>
                <span class="relative z-10">Reserve Ahora!</span>
            </button>

            <button 
                class="menu-hamburguesa flex items-center justify-center text-gray-800 p-2 cursor-pointer md:hidden" 
                id="mobile-menu-open"
                aria-label="Abrir menú de navegación"
            >
                <Icon name="material-symbols:menu" class="w-8 h-8" />
            </button>
        </div>
    </div>
</header>

<div id="mobile-menu" class="fixed inset-0 z-[60] bg-white transform translate-x-full transition-transform duration-300 md:hidden flex flex-col p-6">
    <div class="flex justify-between items-center">
        <img src="/images/logohotel.png" alt="Logo" class="h-12 w-auto" />
        <button 
            class="flex items-center justify-center p-2 cursor-pointer transition-colors hover:bg-gray-100 rounded-full" 
            id="mobile-menu-close"
            aria-label="Cerrar menú de navegación"
        >
            <Icon name="material-symbols:close" class="text-3xl w-8 h-8 text-gray-800" />
        </button>
    </div>
    
    <nav class="flex flex-col gap-4 mt-8">
        <a class={`text-lg font-bold p-3 rounded-lg ${isActive("/") ? "text-blue-ocean bg-blue-ocean/10" : "text-gray-600"}`} href="/">Inicio</a>
        <a class={`text-lg font-bold p-3 rounded-lg ${isActive("/habitaciones") ? "text-blue-ocean bg-blue-ocean/10" : "text-gray-600"}`} href="/habitaciones">Habitaciones</a>
        <a class={`text-lg font-bold p-3 rounded-lg ${isActive("/servicios") ? "text-blue-ocean bg-blue-ocean/10" : "text-gray-600"}`} href="/servicios">Servicios</a>
        <a class={`text-lg font-bold p-3 rounded-lg ${isActive("/alojamientoEmpresas") ? "text-blue-ocean bg-blue-ocean/10" : "text-gray-600"}`} href="/alojamientoEmpresas">Alojamiento para empresas</a>
        
        <div class="mt-4 pt-4 border-t border-gray-100">
            <button class="w-full bg-blue-ocean text-white py-4 rounded-xl font-bold text-lg">
                Reserve Ahora!
            </button>
        </div>
    </nav>
</div>

<style>
    /* Estilos del Link Activo */
    .nav-link { display: inline-block; transition: all 0.3s ease; }
    .nav-link:hover { color: #0077b6; }
    
    .link-active { color: #0077b6 !important; }
    .link-active::after {
        content: ''; 
        position: absolute; 
        bottom: -2px; 
        left: 50%; 
        transform: translateX(-50%);
        width: 100%; 
        height: 2px;
        background: #0077b6;
        border-radius: 2px;
    }
</style>

<script>
    function setupMenu() {
        const header = document.getElementById('main-header');
        const mobileMenu = document.getElementById('mobile-menu');
        const openBtn = document.getElementById('mobile-menu-open');
        const closeBtn = document.getElementById('mobile-menu-close');

        // Lógica de Scroll: Borde inicial -> Sombra y sin borde al bajar
        window.addEventListener('scroll', () => {
            if (window.scrollY > 10) {
                // Estado al bajar el scroll
                header?.classList.remove('border-slate-300/60');
                header?.classList.add('shadow-lg', 'shadow-blue-900/5', 'border-transparent');
                header?.classList.replace('py-2', 'py-1.5');
            } else {
                // Estado inicial (arriba de todo)
                header?.classList.add('border-slate-300/60');
                header?.classList.remove('shadow-lg', 'shadow-blue-900/5', 'border-transparent');
                header?.classList.replace('py-1.5', 'py-2');
            }
        });

        // Mobile Menu Logic
        openBtn?.addEventListener('click', () => {
            mobileMenu?.classList.remove('translate-x-full');
            document.body.style.overflow = 'hidden'; // Evita scroll con menú abierto
        });

        const closeMenu = () => {
            mobileMenu?.classList.add('translate-x-full');
            document.body.style.overflow = '';
        };

        closeBtn?.addEventListener('click', closeMenu);
        
        mobileMenu?.querySelectorAll('a, button').forEach(el => {
            el.addEventListener('click', closeMenu);
        });
    }

    // Se ejecuta al cargar y al navegar (compatible con Astro View Transitions)
    document.addEventListener('astro:page-load', setupMenu);
</script>